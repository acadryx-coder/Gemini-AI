<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Chat - Unlimited</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .message-user { background-color: #3b82f6; color: white; }
        .message-ai { background-color: #f3f4f6; color: black; }
        .typing-indicator { display: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="max-w-2xl mx-auto p-4">
        <h1 class="text-3xl font-bold text-center my-6">ðŸ’¬ Unlimited Gemini Chat</h1>
        
        <div id="chat-container" class="bg-white rounded-lg shadow-lg p-4 mb-4 h-96 overflow-y-auto">
            <div class="text-center text-gray-500 mt-20">
                Start chatting with Gemini...
            </div>
        </div>
        
        <div class="flex gap-2">
            <input type="text" id="message-input" 
                   placeholder="Type your message..." 
                   class="flex-1 p-3 border rounded-lg focus:outline-none focus:border-blue-500"
                   onkeypress="if(event.key === 'Enter') sendMessage()">
            <button onclick="sendMessage()" 
                    class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                Send
            </button>
        </div>
        
        <div class="mt-4 text-sm text-gray-600">
            <label>
                <input type="checkbox" id="save-chat" checked> Save conversation
            </label>
            <button onclick="clearChat()" class="ml-4 text-red-600">Clear Chat</button>
        </div>
    </div>

    <script>
        let conversationId = Date.now().toString();
        
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTyping(true);
            
            try {
                // CORRECTED API ENDPOINT: Use /api/chat NOT /api/chat.js
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        conversationId: conversationId,
                        saveChat: document.getElementById('save-chat').checked
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                showTyping(false);
                
                if (data.reply) {
                    addMessage(data.reply, 'ai');
                } else {
                    addMessage('Error: ' + (data.error || 'No response'), 'ai');
                }
            } catch (error) {
                showTyping(false);
                addMessage('Failed to send: ' + error.message, 'ai');
                console.error('Chat error:', error);
            }
        }
        
        function addMessage(text, sender) {
            const container = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `p-3 rounded-lg mb-2 max-w-[80%] ${sender === 'user' ? 'message-user ml-auto' : 'message-ai'}`;
            messageDiv.textContent = text;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        function showTyping(show) {
            const container = document.getElementById('chat-container');
            let indicator = document.querySelector('.typing-indicator');
            
            if (show && !indicator) {
                indicator = document.createElement('div');
                indicator.className = 'typing-indicator p-3 rounded-lg mb-2 max-w-[80%] message-ai';
                indicator.textContent = 'Gemini is typing...';
                container.appendChild(indicator);
                container.scrollTop = container.scrollHeight;
            } else if (!show && indicator) {
                indicator.remove();
            }
        }
        
        function clearChat() {
            document.getElementById('chat-container').innerHTML = 
                '<div class="text-center text-gray-500 mt-20">Start chatting with Gemini...</div>';
            conversationId = Date.now().toString();
        }
        
        // Enter key support
        document.getElementById('message-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });
        
        // Focus input on load
        window.addEventListener('load', function() {
            document.getElementById('message-input').focus();
        });
    </script>
</body>
</html>
